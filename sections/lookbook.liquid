<section class="lbsection">
   {% if section.settings.heading!=blank %}
    <h2 class="lbheading">{{ section.settings.heading}}</h2>
   {% endif %}

   <div class="lbblocks">
    {% for block in section.blocks %}
        <div class="lbblock" {{ block.shopify_attributes }}>

            <div class="lbbanner">
                {% if block.settings.lbbanner!=blank %}
                    <img src="{{ block.settings.lbbanner | image_url }}" alt="LB Banner">
                    <div class="lbbanner-overlay">
                        {% if block.settings.lbbanner_heading!=blank %}
                            <h3>{{ block.settings.lbbanner_heading }}</h3>
                        {% endif %}
                        {% if block.settings.lbbutton!=blank %}
                            <a href="{{ block.settings.lbbuttonlink }}" class="lb-button">{{ block.settings.lbbutton }}</a>
                        {%  endif %}
                    </div>
                {% endif %}
            </div>

            <div class="lbproducts">
               <div class="lbproduct-slider-wrapper" data-slider-id="slider-{{ block.id }}">
                   <div class="lbproduct-slider">
                       {% if block.settings.product_1 != blank %}
                           {% assign product = block.settings.product_1 %}
                           <div class="lbproduct-card">
                               <a href="{{ product.url }}">
                                   {% if product.available == false %}
                                       <span class="sold-out-badge">Sold Out</span>
                                   {% endif %}
                                   <div class="product-image-wrapper">
                                       <img src="{{ product.featured_image | image_url: width: 400 }}" alt="{{ product.title }}">
                                   </div>
                                   <p class="title">{{ product.title }}</p>
                                   <p class="price">{{ product.price | money }}</p>
                               </a>
                           </div>
                       {% endif %}

                       {% if block.settings.product_2 != blank %}
                           {% assign product = block.settings.product_2 %}
                           <div class="lbproduct-card">
                               <a href="{{ product.url }}">
                                   {% if product.available == false %}
                                       <span class="sold-out-badge">Sold Out</span>
                                   {% endif %}
                                   <div class="product-image-wrapper">
                                       <img src="{{ product.featured_image | image_url: width: 400 }}" alt="{{ product.title }}">
                                   </div>
                                   <p class="title">{{ product.title }}</p>
                                   <p class="price">{{ product.price | money }}</p>
                               </a>
                           </div>
                       {% endif %}

                       {% if block.settings.product_3 != blank %}
                           {% assign product = block.settings.product_3 %}
                           <div class="lbproduct-card">
                               <a href="{{ product.url }}">
                                   {% if product.available == false %}
                                       <span class="sold-out-badge">Sold Out</span>
                                   {% endif %}
                                   <div class="product-image-wrapper">
                                       <img src="{{ product.featured_image | image_url: width: 400 }}" alt="{{ product.title }}">
                                   </div>
                                   <p class="title">{{ product.title }}</p>
                                   <p class="price">{{ product.price | money }}</p>
                               </a>
                           </div>
                       {% endif %}

                       {% if block.settings.product_4 != blank %}
                           {% assign product = block.settings.product_4 %}
                           <div class="lbproduct-card">
                               <a href="{{ product.url }}">
                                   {% if product.available == false %}
                                       <span class="sold-out-badge">Sold Out</span>
                                   {% endif %}
                                   <div class="product-image-wrapper">
                                       <img src="{{ product.featured_image | image_url: width: 400 }}" alt="{{ product.title }}">
                                   </div>
                                   <p class="title">{{ product.title }}</p>
                                   <p class="price">{{ product.price | money }}</p>
                               </a>
                           </div>
                       {% endif %}
                   </div>
                   
                   <div class="slider-navigation">
                       <button class="slider-btn prev-btn" aria-label="Previous product">‹</button>
                       <div class="slider-pagination"></div>
                       <button class="slider-btn next-btn" aria-label="Next product">›</button>
                   </div>
               </div>
            </div>
        </div>
    {% endfor %}
    </div>
</section>

<style>
    .lbsection {
    padding: 60px 0;
    }

    .lbheading {
    text-align: center;
    font-size: 30px;
    margin-bottom: 40px;
    }

    .lbblocks {
    width: 100%;
    }

    .lbblock {
    display: flex;
    gap: 30px;
    padding: 0;
    margin-left: -40px;
    margin-right: -40px;
    width: calc(100% + 80px);
    }

    
    .lbbanner {
    width: 50%;
    position: relative;
    }

    .lbbanner img {
    width: 100%;
    border-radius: 12px;
    }

    .lbbanner-overlay {
    position: absolute;
    bottom: 20px;
    left: 20px;
    right: 20px;
    background: #fff;
    padding: 10px 30px;
    border-radius: 12px;
    display: flex;              
    align-items: center;
    justify-content: space-between;         
    gap: 16px;                   
    }

    .lbbanner-overlay h3 {
    font-size: 15px;    
    margin: 0;
    font-weight: 500;
    line-height: 1.2;
    }

    .lb-button {
    display: inline-block;
    padding: 10px 18px;
    background-color: #1f3d2b;
    color: #ffffff;
    text-decoration: none;
    font-size: 14px;
    border-radius: 25px;
    transition: background-color 0.3s ease;
    }

    .lb-button:hover {
    background-color: #163021;
    }

    .lbproducts {
    width: 50%;
    }

    .lbproduct-slider-wrapper {
    position: relative;
    width: 100%;
    }

    .lbproduct-slider {
    display: flex;
    gap: 0;
    overflow: hidden;
    position: relative;
    transition: transform 0.4s ease-in-out;
    }

    .lbproduct-card {
    min-width: 100%;
    flex-shrink: 0;
    background: #fff;
    padding: 16px;
    border-radius: 8px;
    text-align: left;
    position: relative;
    }

    .sold-out-badge {
    position: absolute;
    top: 20px;
    left: 20px;
    background: #f5f5f5;
    color: #000;
    padding: 4px 12px;
    font-size: 12px;
    border-radius: 4px;
    z-index: 2;
    font-weight: 500;
    }

    .product-image-wrapper {
    width: 100%;
    background: #f5f5f5;
    border-radius: 8px;
    overflow: hidden;
    margin-bottom: 12px;
    aspect-ratio: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    }

    .lbproduct-card img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
    }

    .lbproduct-card .title {
    font-size: 14px;
    margin: 0 0 8px 0;
    color: #000;
    line-height: 1.4;
    font-weight: 400;
    }

    .lbproduct-card .price {
    font-weight: 600;
    font-size: 14px;
    color: #000;
    margin: 0;
    }

    .lbproduct-card a {
    text-decoration: none;
    color: inherit;
    display: block;
    }

    .slider-navigation {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 16px;
    margin-top: 20px;
    }

    .slider-btn {
    background: transparent;
    border: 1px solid #ddd;
    width: 36px;
    height: 36px;
    border-radius: 50%;
    cursor: pointer;
    font-size: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
    color: #333;
    }

    .slider-btn:hover {
    background: #f5f5f5;
    border-color: #333;
    }

    .slider-pagination {
    display: flex;
    gap: 8px;
    align-items: center;
    }

    .pagination-dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: #ddd;
    cursor: pointer;
    transition: all 0.3s ease;
    }

    .pagination-dot.active {
    background: #000;
    width: 24px;
    border-radius: 4px;
    }


/* Mobile */
@media (max-width: 768px) {
    .lbsection {
        padding: 30px 0;
    }

    .lbheading {
        font-size: 22px;
        margin-bottom: 24px;
        padding: 0 16px;
    }

    .lbblock {
        flex-direction: column; 
        gap: 0;
        margin-left: 0;
        margin-right: 0;
        margin-bottom: 24px;
        width: 100% !important;
    }

    .lbblock:last-child {
        margin-bottom: 0;
    }

    .lbbanner {
        width: 100%;
        border-radius: 0;
    }

    .lbbanner img {
        border-radius: 0;
        width: 100%;
        display: block;
    }

    .lbbanner-overlay {
        bottom: 16px;
        left: 16px;
        right: 16px;
        padding: 12px 16px;
        flex-direction: column;
        align-items: flex-start;
        gap: 12px;
    }

    .lbbanner-overlay h3 {
        font-size: 14px;
        margin: 0;
    }

    .lb-button {
        padding: 10px 20px;
        font-size: 13px;
        width: 100%;
        text-align: center;
    }

    .lbproducts {
        width: 100%;
        padding: 16px;
    }

    .lbproduct-card {
        padding: 12px;
    }

    .sold-out-badge {
        top: 16px;
        left: 16px;
        font-size: 11px;
        padding: 3px 10px;
    }

    .lbproduct-card .title {
        font-size: 13px;
        margin: 0 0 6px 0;
        line-height: 1.3;
    }

    .lbproduct-card .price {
        font-size: 14px;
        font-weight: 600;
    }

    .slider-navigation {
        margin-top: 16px;
        gap: 12px;
    }

    .slider-btn {
        width: 32px;
        height: 32px;
        font-size: 20px;
    }

    .pagination-dot {
        width: 6px;
        height: 6px;
    }

    .pagination-dot.active {
        width: 20px;
    }
}

</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const sliderWrappers = document.querySelectorAll('.lbproduct-slider-wrapper');
    
    sliderWrappers.forEach(wrapper => {
        const slider = wrapper.querySelector('.lbproduct-slider');
        const cards = wrapper.querySelectorAll('.lbproduct-card');
        const prevBtn = wrapper.querySelector('.prev-btn');
        const nextBtn = wrapper.querySelector('.next-btn');
        const pagination = wrapper.querySelector('.slider-pagination');
        
        if (cards.length === 0) return;
        
        let currentIndex = 0;
        
        // Create pagination dots
        cards.forEach((_, index) => {
            const dot = document.createElement('div');
            dot.className = 'pagination-dot' + (index === 0 ? ' active' : '');
            dot.addEventListener('click', () => goToSlide(index));
            pagination.appendChild(dot);
        });
        
        const dots = pagination.querySelectorAll('.pagination-dot');
        
        function updateSlider() {
            slider.style.transform = `translateX(-${currentIndex * 100}%)`;
            
            // Update pagination dots
            dots.forEach((dot, index) => {
                dot.classList.toggle('active', index === currentIndex);
            });
            
            // Update button states
            if (prevBtn) {
                prevBtn.style.opacity = currentIndex === 0 ? '0.5' : '1';
                prevBtn.style.cursor = currentIndex === 0 ? 'not-allowed' : 'pointer';
            }
            if (nextBtn) {
                nextBtn.style.opacity = currentIndex === cards.length - 1 ? '0.5' : '1';
                nextBtn.style.cursor = currentIndex === cards.length - 1 ? 'not-allowed' : 'pointer';
            }
        }
        
        function goToSlide(index) {
            if (index < 0) index = 0;
            if (index >= cards.length) index = cards.length - 1;
            currentIndex = index;
            updateSlider();
        }
        
        function nextSlide() {
            if (currentIndex < cards.length - 1) {
                currentIndex++;
                updateSlider();
            }
        }
        
        function prevSlide() {
            if (currentIndex > 0) {
                currentIndex--;
                updateSlider();
            }
        }
        
        if (prevBtn) prevBtn.addEventListener('click', prevSlide);
        if (nextBtn) nextBtn.addEventListener('click', nextSlide);
        
        // Initialize
        updateSlider();
        
        // Auto-play (optional - uncomment if needed)
        // let autoPlayInterval = setInterval(nextSlide, 5000);
        // wrapper.addEventListener('mouseenter', () => clearInterval(autoPlayInterval));
        // wrapper.addEventListener('mouseleave', () => {
        //     autoPlayInterval = setInterval(nextSlide, 5000);
        // });
    });
});
</script>

{% schema %}
{
  "name": "Lookbook",
  "tag": "section",
  "class": "section",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "section heading",
      "default": "Lookbook"
    }
  ],
  "blocks": [
    {
        "type": "item",
        "name":"lbitem",
        "settings": [
            {
                "type": "image_picker",
                "id":"lbbanner",
                "label":"lbbanner"
            },
            {
                "type":"text",
                "id":"lbbanner_heading",
                "label":"LB Banner Heading"
            },
            {
                "type":"url",
                "id":"lbbuttonlink",
                "label":"LB Button link"
            },
            {
                "type":"text",
                "id":"lbbutton",
                "label":"LB Button"
            },
            {
                "type": "product",
                "id": "product_1",
                "label": "Product 1"
            },
            {
                "type": "product",
                "id": "product_2",
                "label": "Product 2"
            },
            {
                "type": "product",
                "id": "product_3",
                "label": "Product 3"
            },
            {
                "type": "product",
                "id": "product_4",
                "label": "Product 4"
            }
        ]
    }
  ],
  "presets": [
    {
      "name": "Lookbook"
    }
  ]
}
{% endschema %}